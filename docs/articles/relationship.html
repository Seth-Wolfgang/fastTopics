<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring the close relationship between topic modeling and non-negative matrix factorization for count data • fastTopics</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Exploring the close relationship between topic modeling and non-negative matrix factorization for count data">
<meta property="og:description" content="fastTopics">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fastTopics</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5-52</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stephenslab/fastTopics">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Exploring the close relationship between topic modeling and non-negative matrix factorization for count data</h1>
                        <h4 class="author">Peter Carbonetto</h4>
            
            <h4 class="date">2021-06-11</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/stephenslab/fastTopics/blob/master/vignettes/relationship.Rmd"><code>vignettes/relationship.Rmd</code></a></small>
      <div class="hidden name"><code>relationship.Rmd</code></div>

    </div>

    
    
<p>The <strong>fastTopics</strong> package implements fast optimization algorithms for fitting topic models and non-negative matrix factorizations to count data. This document explains the close relationship between topic modeling and non-negative matrix factorization (NMF).</p>
<p>These are the packages used in the examples below:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">fastTopics</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">cowplot</span>)</pre></body></html></div>
<div id="poisson-non-negative-matrix-factorization" class="section level2">
<h2 class="hasAnchor">
<a href="#poisson-non-negative-matrix-factorization" class="anchor"></a>Poisson non-negative matrix factorization</h2>
<p>In Poisson non-negative matrix factorization (<a href="http://papers.nips.cc/paper/1861-algorithms-for-non-negative-matrix-factorization">Lee &amp; Seung, 2001</a>), counts <span class="math inline">\(x_{ij}\)</span> in an <span class="math inline">\(n \times m\)</span> matrix, <span class="math inline">\(X\)</span>, are modeled by the Poisson distribution: <span class="math display">\[
x_{ij} \sim \mathrm{Poisson}(\lambda_{ij}).
\]</span> Each Poisson rate, <span class="math inline">\(\lambda_{ij}\)</span>, is a simple linear combination of parameters <span class="math inline">\(f_{jk} \geq 0, l_{ik} \geq 0\)</span> to be fitted to the data: <span class="math display">\[
\lambda_{ij} = \sum_{k=1}^K l_{ik} f_{jk},
\]</span> in which <span class="math inline">\(K\)</span> is a user-specified tuning parameter specifying the rank of the matrix factorization.</p>
<p>The fastTopics function <code>fit_poisson_nmf</code> computes maximum-likelihood estimates (MLEs) of the Poisson NMF parameters. These parameters are stored as an <span class="math inline">\(m \times K\)</span> matrix <span class="math inline">\(F\)</span>, and an <span class="math inline">\(n \times K\)</span> matrix <span class="math inline">\(L\)</span>. Drawing the connection to PCA, we call <span class="math inline">\(L\)</span> the “loadings matrix” (also sometimes called the “activations”), and <span class="math inline">\(F\)</span> is the “factors matrix” (or “basis vectors”). Here we siulate a “toy” data set with <span class="math inline">\(n = 80\)</span>, <span class="math inline">\(m = 100\)</span> and <span class="math inline">\(K = 3\)</span>:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1</span>)
<span class="no">dat</span>  <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/simulate_count_data.html">simulate_count_data</a></span>(<span class="fl">80</span>,<span class="fl">100</span>,<span class="fl">3</span>)
<span class="no">fit1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/fit_poisson_nmf.html">fit_poisson_nmf</a></span>(<span class="no">dat</span>$<span class="no">X</span>,<span class="kw">k</span> <span class="kw">=</span> <span class="fl">3</span>,<span class="kw">numiter</span> <span class="kw">=</span> <span class="fl">200</span>,<span class="kw">verbose</span> <span class="kw">=</span> <span class="st">"none"</span>)
<span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">dat</span>$<span class="no">X</span>),
      <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">fit1</span>$<span class="no">L</span>),
      <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">fit1</span>$<span class="no">F</span>))
<span class="co">#      [,1] [,2]</span>
<span class="co"># [1,]   80  100</span>
<span class="co"># [2,]   80    3</span>
<span class="co"># [3,]  100    3</span></pre></body></html></div>
<p>The fitting procedure finds an <span class="math inline">\(L\)</span> and an <span class="math inline">\(F\)</span> that maximize the likelihood (or, equivalently, that minimize the “deviance”):</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">quickplot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">200</span>,<span class="kw">y</span> <span class="kw">=</span> <span class="no">fit1</span>$<span class="no">progress</span>$<span class="no">loglik</span>,<span class="kw">geom</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"point"</span>,<span class="st">"line"</span>),
  <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"iteration"</span>,<span class="kw">ylab</span> <span class="kw">=</span> <span class="st">"loglik"</span>) + <span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>(<span class="fl">12</span>)</pre></body></html></div>
<p><img src="relationship_files/figure-html/plot-loglik-1.png" width="336" style="display: block; margin: auto;"></p>
<p>Note that the MLE is not unique; if we multiply the <span class="math inline">\(k\)</span>th column of <span class="math inline">\(F\)</span> by some positive scalar, <span class="math inline">\(a_k\)</span>, and divide the corresponding column of <span class="math inline">\(L\)</span> by the same <span class="math inline">\(a_k\)</span>, the likelihood will not change.</p>
</div>
<div id="the-multinomial-topic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#the-multinomial-topic-model" class="anchor"></a>The multinomial topic model</h2>
<p>In the multinomial topic model (<a href="https://doi.org/10.1145/312624.312649">Hofmann, 1999</a>; <a href="http://jmlr.csail.mit.edu/papers/v3/blei03a.html">Blei <em>et al</em>, 2003</a>), each sample, or row of <span class="math inline">\(X\)</span>, is drawn from a multinomial distribution: <span class="math display">\[
x_{i1}, \ldots, x_{im} \,|\, t_i \sim \mathrm{Multinom}(t_i, \pi_i),
\]</span> Here. <span class="math inline">\(t_i = \sum_{j=1}^m x_{ij}\)</span> is the total sample size for the <span class="math inline">\(i\)</span>th row, and the multinomial probabilities are <span class="math display">\[
\pi_{ij} = \sum_{k=1}^K l_{ik}^{\ast} f_{jk}^{\ast}
\]</span></p>
<p>where <span class="math inline">\(l_{ik}^{\ast} \geq 0, f_{jk}^{\ast} \geq 0\)</span>. Note the similarity to the Poisson rates <span class="math inline">\(\lambda_{ij}\)</span> above. There is, however, an important difference: the topic model parameters are additionally constrained so that each row of the loadings matrix, <span class="math inline">\(L^{\ast}\)</span>, and each column of factors matrix, <span class="math inline">\(F^{\ast}\)</span>, sums to 1: <span class="math display">\[
\sum_{k=1}^K l_{ik}^{\ast} = 1, \qquad
\sum_{j=1}^m f_{jk}^{\ast} = 1.
\]</span></p>
<p>With these new constraints, the <span class="math inline">\(\pi_{ij}\)</span>’s are guaranteed to be probabilities, and the factors and loadings have a simple interpretation: <span class="math inline">\(l_{ik}^{\ast}\)</span> is the proportion that topic <span class="math inline">\(k\)</span> contributes to the counts in sample <span class="math inline">\(i\)</span>; <span class="math inline">\(f_{jk}\)</span> is the probability of item <span class="math inline">\(j\)</span> occuring in topic <span class="math inline">\(k\)</span>.</p>
</div>
<div id="from-poisson-nmf-to-topic-model" class="section level2">
<h2 class="hasAnchor">
<a href="#from-poisson-nmf-to-topic-model" class="anchor"></a>From Poisson NMF to topic model</h2>
<p>Having fitted the Poisson NMF model, the multinomial topic model is easily recovered:</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">fit.multinom</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/poisson2multinom.html">poisson2multinom</a></span>(<span class="no">fit1</span>)</pre></body></html></div>
<p>The rows of <span class="math inline">\(L\)</span> and columns of <span class="math inline">\(F\)</span> indeed sum to 1:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">fit.multinom</span>$<span class="no">L</span>))
<span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colSums</a></span>(<span class="no">fit.multinom</span>$<span class="no">F</span>))
<span class="co"># [1] 1 1</span>
<span class="co"># [1] 1 1</span></pre></body></html></div>
<p>The multinomial topic model is in fact a <em>reparameterization</em> of the Poisson NMF model; in particular, the <em>likelihood does not change with this reparameterization.</em> We have the following result: <span class="math display">\[
\mathrm{Multinom}(x_i; t_i, \pi_i) \times \mathrm{Poisson}(t_i;
s_i) = \prod_{j=1}^m \mathrm{Poisson}(x_{ij}; \lambda_{ij}),
\]</span> in which the <span class="math inline">\(s_i\)</span>’s are the “size factors”. We can check that this result holds in the toy data:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">ll.pnmf</span>     <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/likelihood.html">loglik_poisson_nmf</a></span>(<span class="no">dat</span>$<span class="no">X</span>,<span class="no">fit1</span>)
<span class="no">ll.multinom</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/likelihood.html">loglik_multinom_topic_model</a></span>(<span class="no">dat</span>$<span class="no">X</span>,<span class="no">fit.multinom</span>) +
               <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html">dpois</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">dat</span>$<span class="no">X</span>),<span class="no">fit.multinom</span>$<span class="no">s</span>,<span class="kw">log</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">quickplot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">ll.pnmf</span>,<span class="kw">y</span> <span class="kw">=</span> <span class="no">ll.multinom</span>) + <span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>(<span class="fl">12</span>)</pre></body></html></div>
<p><img src="relationship_files/figure-html/loglik-poisson-vs-multinom-1.png" width="312" style="display: block; margin: auto;"></p>
</div>
<div id="from-topic-model-to-poisson-nmf" class="section level2">
<h2 class="hasAnchor">
<a href="#from-topic-model-to-poisson-nmf" class="anchor"></a>From topic model to Poisson NMF</h2>
<p>We can also easily go in the reverse direction, from multinomial topic model fit to Poisson NMF fit. Here is an example, using the same toy data set (the size factor estimates returned by <code>poisson2multinom</code> were removed first to demonstrate that they are not needed):</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">fit.multinom</span>[<span class="st">"s"</span>] <span class="kw">&lt;-</span> <span class="kw">NULL</span>
<span class="no">fit2</span>    <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/multinom2poisson.html">multinom2poisson</a></span>(<span class="no">fit.multinom</span>,<span class="no">dat</span>$<span class="no">X</span>)
<span class="no">loglik1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/likelihood.html">loglik_poisson_nmf</a></span>(<span class="no">dat</span>$<span class="no">X</span>,<span class="no">fit1</span>)
<span class="no">loglik2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/likelihood.html">loglik_poisson_nmf</a></span>(<span class="no">dat</span>$<span class="no">X</span>,<span class="no">fit2</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">quickplot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">loglik1</span>,<span class="kw">y</span> <span class="kw">=</span> <span class="no">loglik2</span>) + <span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>(<span class="fl">12</span>)</pre></body></html></div>
<p><img src="relationship_files/figure-html/multinom2poisson-1-1.png" width="312" style="display: block; margin: auto;"></p>
<p>From this plot, we see that the likelihoods for the original Poisson NMF fit, and the one recovered from the topic model, are exactly the same. (Note that the factors and loadings will not necessarily be the same—they will only the same up to a rescaling of the columns).</p>
<p>The reverse transformation from multinomial topic model back to Poisson NMF is in fact <em>very</em> simple, involving only a simple rescaling of the loadings by the total counts for each sample (the function <code>multinom2poisson</code> is really only needed for additional bookkeeping):</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">s</span>           <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span>(<span class="no">dat</span>$<span class="no">X</span>)
<span class="no">fit3</span>        <span class="kw">&lt;-</span> <span class="no">fit.multinom</span>
<span class="no">fit3</span>$<span class="no">L</span>      <span class="kw">&lt;-</span> <span class="no">s</span> * <span class="no">fit3</span>$<span class="no">L</span>
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">fit3</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"poisson_nmf_fit"</span>,<span class="st">"list"</span>)
<span class="no">loglik3</span>     <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/likelihood.html">loglik_poisson_nmf</a></span>(<span class="no">dat</span>$<span class="no">X</span>,<span class="no">fit3</span>)
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/qplot.html">quickplot</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">loglik1</span>,<span class="kw">y</span> <span class="kw">=</span> <span class="no">loglik3</span>) + <span class="fu"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>(<span class="fl">12</span>)</pre></body></html></div>
<p><img src="relationship_files/figure-html/multinom2poisson-2-1.png" width="312" style="display: block; margin: auto;"></p>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>The “fastTopics” approach aims to combine the advantages of Poisson NMF and topic modeling.</p>
<p>The Poisson NMF is easier to fit because it doesn’t have the additional constraints.</p>
<p>On ther other hand, the parameters of the topic model are typically more useful for for understanding data; for example, the <span class="math inline">\(l_{ik}^{\ast}\)</span>’s are topic proportions, which can be used to compare samples (documents), among other things.</p>
<p>So we provide a function to fit the Poisson NMF model (<code>fit_poisson_nmf</code>), and another function to obtain the topic model fit (<code>poisson2multinom</code>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Peter Carbonetto, Kevin Luo, Kushal Dey, Matthew Stephens.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
